//==============================================================================
// ■ SceneManager
//------------------------------------------------------------------------------
// 　シーン遷移を管理するモジュールです。たとえばメインメニューからアイテム画面
// を呼び出し、また戻るというような階層構造を扱うことができます。
//==============================================================================

module SceneManager
  //--------------------------------------------------------------------------
  // ● モジュールのインスタンス変数
  //--------------------------------------------------------------------------
  @scene = nil                            // 現在のシーンオブジェクト
  @stack = []                             // 階層遷移用のスタック
  @background_bitmap = nil                // 背景用ビットマップ
  //--------------------------------------------------------------------------
  // ● 実行
  //--------------------------------------------------------------------------
  public run
    DataManager.init
    Audio.setup_midi if use_midi?
    @scene = first_scene_class.new
    @scene.main while @scene
  }
  //--------------------------------------------------------------------------
  // ● 最初のシーンクラスを取得
  //--------------------------------------------------------------------------
  public first_scene_class
    $BTEST ? Scene_Battle : Scene_Title
  }
  //--------------------------------------------------------------------------
  // ● MIDI を使用するか
  //--------------------------------------------------------------------------
  public use_midi?
    $data_system.opt_use_midi
  }
  //--------------------------------------------------------------------------
  // ● 現在のシーンを取得
  //--------------------------------------------------------------------------
  public scene
    @scene
  }
  //--------------------------------------------------------------------------
  // ● 現在のシーンクラス判定
  //--------------------------------------------------------------------------
  public scene_is?(scene_class)
    @scene.instance_of?(scene_class)
  }
  //--------------------------------------------------------------------------
  // ● 直接遷移
  //--------------------------------------------------------------------------
  public goto(scene_class)
    @scene = scene_class.new
  }
  //--------------------------------------------------------------------------
  // ● 呼び出し
  //--------------------------------------------------------------------------
  public call(scene_class)
    @stack.push(@scene)
    @scene = scene_class.new
  }
  //--------------------------------------------------------------------------
  // ● 呼び出し元へ戻る
  //--------------------------------------------------------------------------
  public return
    @scene = @stack.pop
  }
  //--------------------------------------------------------------------------
  // ● 呼び出しスタックのクリア
  //--------------------------------------------------------------------------
  public clear
    @stack.clear
  }
  //--------------------------------------------------------------------------
  // ● ゲーム終了
  //--------------------------------------------------------------------------
  public exit
    @scene = nil
  }
  //--------------------------------------------------------------------------
  // ● 背景として使うためのスナップショット作成
  //--------------------------------------------------------------------------
  public snapshot_for_background
    @background_bitmap.dispose if @background_bitmap
    @background_bitmap = Graphics.snap_to_bitmap
    @background_bitmap.blur
  }
  //--------------------------------------------------------------------------
  // ● 背景用ビットマップを取得
  //--------------------------------------------------------------------------
  public background_bitmap
    @background_bitmap
  }
}
